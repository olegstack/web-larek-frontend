 # Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

 Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Архитектура проекта строится по модели MVP (Model-View-Presenter).

- Слой данных (Model) — управляет логикой и данными приложения, в том числе каталогом товаров, корзиной, заказами и валидацией.

- Слой представления (View) — включает компоненты интерфейса, такие как карточки товаров, корзина, форма заказа.

- Презентер (Presenter) —  связывает представление с данными, обрабатывая события и обновляя интерфейс.

### Базовые классы

#### Класс EventEmitter

Класс содержит классическую реализацию EventEmitter (брокера событий) с рядом возможностей для работы с событиями, такими как подписка, генерация и триггеринг событий. Основная цель — отделить компоненты приложения, предоставляя механизм для их взаимодействия через события.
Методы:

- `on` - подписывает обработчик на событие
- `emit` - генерирует событие с передачей данных подписчикам.
- `trigger` - создаёт обработчик, который автоматически будет генерировать событие с определённым контекстом при вызове.

#### Класс Api

Класс Api предоставляет методы для выполнения HTTP-запросов к серверу, включая получение, отправку и обновление данных. Все запросы используют базовый URL, который передается при создании экземпляра класса. По умолчанию в заголовках запросов указывается `Content-Type: application/json`.

Конструктор:

`constructor(baseUrl: string, options: RequestInit = {})`-  принимает url сервера, по которому будут совершаться запросы и общие опции для этих запросов.

- `baseUrl:(string)` - Базовый URL, на который будут направляться все запросы.\
- `options:(RequestInit)` - необязательный параметр. Глобальные настройки запросов, такие как заголовки, метод, и другие параметры, передаваемые в стандартный fetch API. По умолчанию добавляется заголовок Content-Type: application/json.

Методы:

- `handleResponse` - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате json или отклоненный промис с возникшей ошибкой.
- `get` - ыполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.

#### Класс Component

Абстрактный класс для компонентов, работающих с DOM. Используется как основа для классов отображения элементов интерфейса и взаимодействия с DOM.

- `toggleClass` - добавляет или убирает класс у элемента.
- `setText` - устанавливает текст для элемента.
- `setDisabled` - управляет атрибутом disabled.
- `setImage` - устанавливает изображение и альтернативный текст.
- `setHidden` - cкрывает элемент, изменяя его CSS-свойство display на none;
- `render` - возвращает корневой элемент DOM-компонента.

#### Класс Model

Абстрактный класс для моделей данных, который поддерживает обновления с помощью emitChanges. Это позволяет отслеживать изменения в данных и взаимодействовать с другими компонентами. 

### Слой данных  (Model)

#### Класс ProductItem

Реализует модель продукта. Основные свойства:

- `id` -  уникальный идентификатор.
- `description` - описание.
- `image` - ссылка на изображение.
- `title` - название.
- `category` - категория товара.
- `price` - цена товара (может быть null).
- `productInBasket` - флаг наличия товара в корзине.

Методы:

- `addToBasket` и `removeFromBasket`- добавляет и удаляет товары из корзины.
- `isInBasket` - метод для проверки, находится ли продукт в корзине

#### Класс AppState

Управляет данными всего приложения: каталогом, корзиной и заказами.

Поля:

- `basket` - корзина с продуктами.
- `catalog` -  cписок продуктов.
- `order` -  заказ, включающий поля оплаты, контактную информацию и товары.
- `preview` -  для предварительного просмотра карточки товара 
- `formErrors` -  объект ошибок формы.

Основные методы:

- `setCatalog` -  заполняет каталог и обновляет список.
- `setPreview` - отвечает за открытие предварительного просмотра товара
- `getProductsInBasket` - Получает товары, находящиеся в корзине
- `addToBasket` и `removeFromBasket`- добавляет и удаляет товары из корзины.
- `getTotalPrice` - рассчитывает итоговую стоимость товаров в корзине.
- `clearBasket` - очищает корзину.
- `clearOrder` - очищает заказ.
- `updateOrderItems` - Обновление данных заказа на основе корзины
- `setModalForm` -  устанавливает значение для указанного поля формы заказа и проверяет, валидна ли форма.
- `setModalContact` -  устанавливает значение для указанного поля формы заполнения контактной информации и проверяет, валидна ли форма;
- `validateModalForm` и `validateModalContact` - проверка контактных данных и формы заказа.
- `getOrder` - возвращает данные заказа.

### Слой представления (View)

#### Класс Modal

Отвечает за управление модальными окнами: открытие, закрытие, смена содержимого. Конструктор принимает контейнер модального окна и объект событий. Внутри конструктора определяется содержимое модального окна и кнопка закрытия.

Методы:

- `set content` - устанавливает содержимое модального окна.
- `open` и `close`- открывает и закрывает модальное окно, генерируя соответствующие события.
- `render` - метод для отрисовки контента модального окна и его последующего открытия.


#### Класс Form

Этот класс расширяет базовый класс Component и реализует функциональность для управления формами, их валидацией, отображением ошибок и взаимодействием с событиями. Интерфейс Form наследуется от IFormState и добавляет два новых свойства:

- `valid` - указывает валидна ли форма
- `errors` - массив ошибок валидации

Поля:

- `_errors` - элемент, отвечающий за отображение ошибок в форме
- `_submit` - кнопка отправки формы

Методы:

- `onInputChanged` -  реагирует на изменения полей формы.
- `set valid` - управляет доступностью кнопки отправки.
- `set errors`- устанавливает текст ошибок.
- `render`- метод для рендеринга формы.


#### Класс Page
Класс Page наследуется от базового класса Component и представляет собой компонент для управления различными элементами страницы. Включает такие элементы, как каталог, счётчик корзины и кнопка корзины.

Поля:
- `_counter`- количество товаров в корзине
- `_catalog` - элемент галереи товаров на главной странице
- `_wrapper` - обертка страницы которую можно блокировать, например, добавляя специальный класс
- `basket`- кнопка открытия корзины

Методы:

- `counter` -  устанавливает количество товаров в корзине.
- `catalog` - обновляет список товаров на странице.
- `locked`- блокирует или разблокирует прокрутку страницы при открытии модальных окон.

#### Класс ProductCard 

Класс для отображения карточек товаров

Поля:

- `_image` - сссылка на картинку с карточкой товара.
- `_title` -  заголовок карточки
- `_category` -  категория товара
- `_price` - стоимость товара
- `_button`- кнопка добавления товара в корзину
- `_description`- описание товара

Методы:

- `set title` -  устанавливает заголовок карточки
- `set image`- устанавливает картинку продукта
- `set category`- устанавливает категорию продукта на главной странице
- `set description` - устанавливает описание продукта
- `set price` -  устанавливает стоимость продукта
- `set changeName` - определяет лейбл кнопки добавления товара в корзину в зависимости от того был ли товар добавлен ранее или нет
- `setData` - Устанавливает значения, затем позволяет сохранить идентификатор продукта в DOM

#### Класс CardInBasket

Класс для отображения карточки товара в корзине, расширяет базовый класс Card.

### Корзина и формы заказа

#### Класс Basket

Компонент для управления корзиной, включающий отображение товаров и итоговой стоимости.

Поля:

- `_list` -  контейнер для товаров в корзине
- `_total` - контейнер для отображения итоговой стоимости
- `_button`- кнопка добавления заказа

Методы:

- `set items` - обновляет содержимое корзины.
- `set total`- устанавливает общую стоимость товаров.

#### Классы OrderForm и ModalContacts

OrderForm - форма для ввода адреса доставки и выбора способа оплаты.
ModalContacts - форма для ввода контактных данных: email и телефон.

#### Класс Success

Класс отвечает за отображения страницы успешного оформления заказа и итоговой стоимости

### Слой представления (Presenter)

Файл index.ts выполняет роль презентера. Он управляет взаимодействием между моделью и представлением с помощью событий, инициируемых через EventEmitter.

Список событий:

- `items:changed` - обновление каталога товаров. После загрузки новых данных модель обновляется, и карточки товаров перерисовываются в галерее.
- `card:select`- выбор карточки товара. Данные выбранного товара передаются в модель для дальнейшего использования.
- `preview:changed` - открытие модального окна с предварительным просмотром товара. Отображает подробную информацию о выбранном товаре.
- `basket:open`- открытие корзины и обновление её содержимого.
- `basket:changed`-  изменение товаров в корзине. При изменении содержимого корзины происходит обновление её отображения.
- `order:open` - открытие формы заказа. Позволяет пользователю ввести данные для оформления заказа.
- `modal:open`- открытие модального окна. При открытии модального окна происходит блокировка прокрутки главной страницы.
- `modal:close`- закрытие модального окна. Снимается блокировка прокрутки главной страницы.
- `formOrderErrors:change` и `formContactsErrors:change` - обновление состояния ошибок валидации.
- `order:submit` - отправка формы заказа. При отправке формы заказа данные передаются на сервер.
- `order.payment:change` - изменение способа оплаты. Обновляет выбранный пользователем способ оплаты.
- `contacts:submit`- события сабмита формы запроверки контактных данныхказа

Эти события обеспечивают связь между компонентами приложения, обеспечивая удобное и отзывчивое взаимодействие для пользователя.

