# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Данные и типы данных, используемые в приложении

Карточка товаров

```
interface IProduct {
    id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Интерфейс выбранной карточки товара

```
interface IProductCardData {
	products: IProduct[];
	preview: string | null;
}
	
```

Интерфейс корзины

```
interface ICartData {
	items: ICartItem[];
	totalPrice: number;
}
```

Интерфейс элемента корзины

```
interface ICartItem {
    product: IProduct; 
    quantity: number; 
}
```

Определения способа оплаты товара

```
enum PaymentMethod {
	online = 'online',
	onDelivery = 'on_delivery',
}
```

## Архитектура приложения

Приложение построено по принципам MVP-архитектуры, разделяя код на три основных слоя:
- Слой представления (View) — отвечает за визуализацию данных и взаимодействие с пользователем.
- Слой данных (Model) — хранит и управляет бизнес-логикой и данными приложения.
- Презентер (Presenter) — связывает представление и данные, обеспечивая обмен данными и обработку событий между ними.  

### Базовый код

#### Класс ApiClient

Класс ApiClient реализует взаимодействие с сервером, предоставляя методы для отправки HTTP-запросов. В конструктор передаются базовый URL сервера и опционально заголовки запросов. Методы:

- `get` - выполняет GET-запрос на указанный эндпоинт, возвращая данные в виде промиса.
- `post` - отправляет данные в формате JSON на указанный эндпоинт с помощью POST-запроса. 
- `delete` - выполняет DELETE-запрос для удаления данных на сервере.

#### Класс EventEmitter

EventEmitter выступает брокером событий, позволяя компонентам приложения отправлять и подписываться на события. Этот класс используется для связи слоев приложения через события. Методы:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

### Слой данных

#### Класс ProductCardData

Класс отвечает за управление товарами. Он поддерживает добавление новых товаров, поиск по идентификатору и выбор товара для предварительного просмотра. Кроме того, класс интегрирован с системой событий, что позволяет инициировать события для взаимодействия с другими частями приложения (например, отображение модального окна с товаром).

- products: IProduct[] - массив объектов товаров, доступных в магазине
- preview: string | null - идентификатор товара, выбранного для отображения в модальном окне.
- events: IEvents - экземпляр класса EventEmitter, который используется для инициирования событий при изменении данных.

 Методы:

- addProduct(product: IProduct): void - добавляет новый товар в массив товаров и инициализирует событие обновления товаров.
- getProductById(product: string): IProduct | undefined - возвращает товар по его идентификатору (если найден), иначе возвращает undefined.
- setPreviewProduct(productId: string): void - устанавливает товар для предварительного просмотра, если товар найден, и инициализирует событие для отображения товара в модальном окне.
- getAllProducts(): IProduct[] - возвращает все товары, находящиеся в массиве

#### Класс CartData

Класс отвечает за управление корзиной. Он поддерживает добавление товаров в корзину, удаление товаров, очистку корзины, а также расчет общей стоимости всех товаров. Класс обеспечивает корректное управление количеством каждого товара и позволяет легко взаимодействовать с данными корзины.

- items: ICartItem[] -  массив объектов товаров, добавленных в корзину.
- totalPrice: number - общая стоимость всех товаров в корзине.

Методы: 

- addItem(product: IProduct, quantity: number): void - добавляет товар в корзину.
- deleteCart(productId: string, payload: Function | null = null): void - удаляет товар из корзины по его идентификатору. Если передан колбэк, выполняет его после удаления, в противном случае инициирует событие изменения корзины
- clearCart(): void - очищает корзину, удаляя все товары
- getCartItems(): ICartItem[] - возвращает массив всех товаров, находящихся в корзине.
- calculateTotalPrice(): number - пересчитывает общую стоимость всех товаров в корзине, автоматически вызывается при изменении кол-ва товара

#### Класс ValidationData

Этот класс отвечает за валидацию пользовательских данных при оформлении заказа: адреса, номера телефона, email и способа оплаты.

Методы:

- validateAddress(address: string): boolean -  проверяет, что поле адреса не пустое.
- validatePhoneNumber(phoneNumber: string): boolean  проверяет, что введенный номер телефона соответствует
- validateEmail(email: string): boolean - проверяет корректность email
- validateAddress(address: string): boolean -  проверяет, что поле адреса не пустое.
- validatePaymentMethod(paymentMethod: PaymentMethod): boolean - проверяет, что выбран валидный способ оплаты (online или onDelivery)

### Классы представления 

Все классы представления отвечают за управление отображением и взаимодействием с DOM-элементами, предоставляя методы для работы с модальными окнами и другими компонентами интерфейса.

#### Класс Modal

Этот класс управляет общим функционалом модальных окон. Он предоставляет методы для открытия и закрытия любого модального окна.

Конструктор:

- constructor(selector: string);

Принимает селектор для поиска модального окна в разметке.

Поля класса:

- modal: HTMLElement - элемент модального окна, найденный по селектору.
- overlay: HTMLElement -  элемент оверлея для закрытия окна по клику
- closeButton: HTMLButtonElement - кнопка для закрытия модального окна

Методы:

- open(): void - открывает модальное окно, добавляя нужные классы и события.
- close():void - закрывает модальное окно, удаляя классы и события
- setEventListeners(): void - добавляет слушатель события для закрывания окна по клику на оверлей и кнопку "крестик"

#### Класс ModalProductPreview

Этот класс является дочерним классом Modal и управляет модальным окном для предварительного просмотра карточки товара.

Конструктор:

- constructor(selector: string, product: IProduct)

Принимает селектор модального окна и данные о товаре для отображения

Поля класса:

- product: IProduct - объект товара для отображения
- image: HTMLImageElement - элемент изображение товара
- title: HTMLElement - заголовок товара
- description: HTMLElement - описание товара
- price: HTMLElement - цена товара
- addButton: HTMLButtonElement - кнопка добавления в корзину

Методы:

- renderProduct(): void - отображает карточку товара в модальном окне (заголовок, изображение, описание, цена и кнопка добавления в корзину)
- addToCart(): void - инициализирует событие добавления товара в корзину при нажатии на кнопку "В корзину".

#### Класс ProductList

Класс для управления отображением списка товаров на главной странице.

Конструктор:

- constructor(container: HTMLElement);

Принимает контейнер для отображения списка товаров.

Поля класса:

- container: HTMLElement -  контейнер для размещения карточек товаров

Методы:

- renderProducts(products: IProduct[]): void - отображает список товаров в контейнере.

#### Класс ModalCart

Класс управляет отображением корзины в модальном окне.

Конструктор:

- constructor(selector: string, cart: ICartData)

Принимает селектор модального окна и объект корзины.

Поля класса:

- cart: ICartData - объект корзины.
- itemsList: HTMLElement - элемент списка товаров в корзине.
- totalPrice: HTMLElement - элемент для отображения общей стоимости товаров
- checkoutButton: HTMLButtonElement - кнопка для оформления заказа.

Методы:

-renderCartItems(items: ICartItem[]): void- отображает товары, добавленные в корзину.
- updateTotalPrice(total: number): void - обновляет общую стоимость товаров.
- clearCart(): void - очищает корзину и обновляет отображение.

#### Класс FormValidation

Класс для валидации форм ввода (адрес доставки, контактные данные и т.д.).

Конструктор: 

- constructor(formElement: HTMLFormElement);

Принимает элемент формы для валидации.

Поля класса:

- formElement: HTMLFormElement - элемент формы.

Методы:

- validate(): boolean - проверяет правильность всех полей формы и возвращает true, если они валидны.
- showErrorMessages(errors: string[]): void - отображает сообщения об ошибках, если они есть.

### Слой коммуникации 

#### Класс AppApi

Этот класс отвечает за взаимодействие с бэкэндом и принимает в конструкторе экземпляр класса ApiClient. Он предоставляет методы для работы с сервером, такие как загрузка данных о товарах, добавление товара в корзину, оформление заказа и управление данными пользователя.

## Взаимодействие компонентов 

Код, описывающий взаимодействие между представлением и данными, находится в файле `index.ts`, выполняющий роль презентера. Он отвечает за инициализацию всех компонентов и настройку обмена данными между ними.\
В index.ts создаются экземпляры всех классов представления, данных и коммуникации.\
Взаимодействие между слоями (View и Model) осуществляется через события, генерируемые с помощью брокера событий (EventEmitter) и обработчики событий.

*Список всех событий, которые могут генерироваться в системе*\
*События изменения данных (генерируется классами моделями данных)*

- `products:changed` - генерируется при добавлении, обновлении или удалении товаров в массиве товаров. Отвечает за обновление интерфейса с товарами на странице.
- `cart:changed` -  генерируется при изменении содержимого корзины (например, добавление, удаление товара). Обновляет отображение корзины.
- `product:preview` -  генерируется при выборе товара для предпросмотра. Активирует отображение модального окна с деталями товара.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `product:selected` - выбор товара для просмотра в модальном окне. Генерируется при клике на карточку товара в списке.
- `product:addToCart` - добавление товара в корзину из карточки товара. Генерируется при нажатии на кнопку "Купить" в модальном окне товара.
- `cart:open` - открытие корзины с товарами. Генерируется при клике на иконку корзины.
- `cart:clear` - очистка содержимого корзины. Генерируется при нажатии на кнопку очистки корзины.
- `order:submit` - оформление заказа. Генерируется при нажатии на кнопку "Оформить заказ" на странице корзины или модального окна.
